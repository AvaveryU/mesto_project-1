(()=>{"use strict";var e=document.querySelectorAll(".popup"),t=document.querySelector(".popup_type_edit"),n=t.querySelector(".form__button"),r=t.querySelector(".form"),o=r.querySelector(".form__item_type_description"),c=r.querySelector(".form__item_type_name"),a=document.querySelector(".popup_type_add"),i=a.querySelector(".form__button"),u=a.querySelector(".form"),l=u.querySelector(".form__item_type_location"),s=u.querySelector(".form__item_type_link"),d=document.querySelector(".popup_type_avatar"),f=d.querySelector(".form__button"),_=d.querySelector(".form_type_avatar"),m=_.querySelector(".form__item_type_avatar"),p=document.querySelector(".popup__remove-card"),y=p.querySelector(".form__button"),v=p.querySelector(".form_type_remove-card"),h=document.querySelector(".popup_type_image"),S=h.querySelector(".popup__image"),b=h.querySelector(".popup__title"),q=(h.querySelector(".popup__close"),document.querySelector(".profile__button_act_edit")),L=document.querySelector(".profile__button_act_add"),g=document.querySelector(".profile__button_act_avatar"),E=document.querySelector(".places"),C=document.querySelector("#card_template").content,k=document.querySelector(".profile__name"),x=document.querySelector(".profile__description"),A=document.querySelector(".profile__image"),w={formSelector:".form",inputSelector:".form__item",submitButtonSelector:".form__button",errorClass:"form__item_type_active",inputErrorClass:"form__input-error",inactiveButtonClass:"form__button_disabled"},U={baseURL:"https://nomoreparties.co/v1/plus-cohort7",headers:{authorization:"bb6ff8a2-6249-481e-b654-c07491020021","Content-Type":"application/json"}};function T(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var R=function(e){"Escape"===e.key&&O(document.querySelector(".popup_opened"))},B=function(e){e.target.classList.contains("popup_opened")&&O(e.currentTarget),e.target.classList.contains("popup__close")&&O(e.currentTarget)};function j(){var e=v.value,t=document.getElementById("".concat(e));N(!0,y),function(e){return fetch("".concat(U.baseURL,"/cards/").concat(e),{method:"DELETE",headers:U.headers}).then(T)}(e).then((function(){t.remove(),O(p)})).catch((function(e){return console.log("Ошибка при удалении карточки: ".concat(e))})).finally((function(){N(!1,y)}))}function D(e){b.textContent=e.target.alt,S.alt=e.target.alt,S.src=e.target.src,P(h)}function O(e){e.classList.remove("popup_opened"),window.removeEventListener("keydown",R)}function P(e){e.classList.add("popup_opened"),window.addEventListener("keydown",R)}function I(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function N(e,t){t.textContent=e?"Удаление...":"Да"}var J=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))};function H(e,t,n){n.prepend(function(e,t){var n=C.querySelector(".card").cloneNode(!0),r=n.querySelector(".card__image"),o=n.querySelector(".card__description"),c=n.querySelector(".card__like"),a=n.querySelector(".card__like-counter");r.alt=e.name,r.src=e.link,o.textContent=e.name,n.id=e._id,a.textContent=e.likes.length,c.addEventListener("click",(function(){c.classList.contains("card__like_pos_active")?function(e){return fetch("".concat(U.baseURL,"/cards/likes/").concat(e),{method:"DELETE",headers:U.headers}).then(T)}(e._id).then((function(e){a.textContent=e.likes.length,c.classList.remove("card__like_pos_active")})).catch((function(e){return console.log("Ошибка: ".concat(e))})):function(e){return fetch("".concat(U.baseURL,"/cards/likes/").concat(e),{method:"PUT",headers:U.headers}).then(T)}(e._id).then((function(e){a.textContent=e.likes.length,c.classList.add("card__like_pos_active")})).catch((function(e){return console.log("Ошибка: ".concat(e))}))}));var i=n.querySelector(".card__trash");return e.owner._id!==t&&i.remove(),i.addEventListener("click",(function(){return t=e._id,v.value=t,y.addEventListener("click",j),void P(p);var t})),r.addEventListener("click",D),n}(e,t))}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}q.addEventListener("click",(function(){c.value=k.textContent,o.value=x.textContent,P(t)})),L.addEventListener("click",(function(){P(a)})),g.addEventListener("click",(function(){P(d)})),_.addEventListener("submit",(function(e){!function(e){var t;e.preventDefault(),I(!0,f),(t=m.value,fetch("".concat(U.baseURL,"/users/me/avatar"),{method:"PATCH",headers:U.headers,body:JSON.stringify({avatar:t})}).then(T)).then((function(e){A.src=e.avatar,O(d),_.reset(),f.disabled=!0,f.classList.add(w.inactiveButtonClass)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){I(!1,f)}))}(e)})),r.addEventListener("submit",(function(e){!function(e){var r,a;e.preventDefault(),I(!0,n),(r=c.value,a=o.value,fetch("".concat(U.baseURL,"/users/me"),{method:"PATCH",headers:U.headers,body:JSON.stringify({name:r,about:a})}).then(T)).then((function(e){k.textContent=e.name,x.textContent=e.about,O(t)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){I(!1,n)}))}(e)})),u.addEventListener("submit",(function(e){e.preventDefault();var t,n,r=l.value,o=s.value;I(!0,i),(t=r,n=o,fetch("".concat(U.baseURL,"/cards"),{method:"POST",headers:U.headers,body:JSON.stringify({name:t,link:n})}).then(T)).then((function(e){H(e,e.owner._id,E),i.disabled=!0,i.classList.add(w.inactiveButtonClass),u.reset(),O(a)})).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){I(!1,i)}))})),e.forEach((function(e){e.addEventListener("mousedown",B)})),function(e){var t=document.querySelectorAll(e.formSelector),n=Array.from(t),r=function(e){e.preventDefault()};n.forEach((function(t){t.addEventListener("submit",r),function(e,t){var n=e.querySelectorAll(t.inputSelector),r=Array.from(n),o=e.querySelector(t.submitButtonSelector);J(r,o,t),r.forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n){var r=e.querySelector(".form__item_type_error-".concat(t.id));t.validity.valid?function(e,t,n){t.textContent="",t.classList.remove(n.errorClass),e.classList.remove(n.inputErrorClass)}(t,r,n):function(e,t,n,r){t.textContent=n,t.classList.add(r.errorClass),e.classList.add(r.inputErrorClass)}(t,r,t.validationMessage,n)}(e,n,t),J(r,o,t)}))}))}(t,e)}))}(w);var z=[fetch("".concat(U.baseURL,"/cards"),{headers:U.headers}).then(T),fetch("".concat(U.baseURL,"/users/me"),{headers:U.headers}).then(T)];Promise.all(z).then((function(e){var t,n,r,o=(r=2,function(e){if(Array.isArray(e))return e}(n=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,i=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(i)throw o}}return c}}(n,r)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];(t=a)._id,k.textContent=t.name,x.textContent=t.about,A.src=t.avatar,c.reverse().forEach((function(e){H(e,a._id,E)}))})).catch((function(e){return console.log("Ошибка загрузки данных: ".concat(e))}))})();